<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Wrapped 2025 | Your Year in Code</title>
    <meta name="description"
        content="Generate your GitHub Wrapped 2025! visualized contribution graph, developer persona, top languages, and viral badges. Share your coding story.">
    <meta name="keywords"
        content="github wrapped, year in code, developer stats, coding statistics, github visualization, developer persona">
    <meta name="author" content="GitHub Wrapped">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://programmerraja.github.io/githubwrap/">
    <meta property="og:title" content="GitHub Wrapped 2025 | Your Year in Code">
    <meta property="og:description"
        content="Discover your developer persona, unlock badges, and see your top projects of 2025.">
    <meta property="og:image" content="http://programmerraja.github.io/githubwrap/preview.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="http://programmerraja.github.io/githubwrap/">
    <meta property="twitter:title" content="GitHub Wrapped 2025 | Your Year in Code">
    <meta property="twitter:description"
        content="Discover your developer persona, unlock badges, and see your top projects of 2025.">
    <meta property="twitter:image" content="http://programmerraja.github.io/githubwrap/preview.png">

    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Grotesk:wght@500;600;700;800&display=swap"
        rel="stylesheet">
</head>
<style>
    :root {
        /* Default Dark Theme (GitHub Dark) */
        --bg-color: #0d1117;
        --text-primary: #e6edf3;
        --text-secondary: #8b949e;
        --card-bg: #161b22;
        --card-border: #30363d;
        --accent-green: #2ea043;
        --accent-blue: #58a6ff;
        --accent-purple: #bc8cff;
        --accent-pink: #ff7b72;
        --accent-orange: #d29922;
        --accent-yellow: #d29922;
    }

    [data-theme="light"] {
        --bg-color: #ffffff;
        --text-primary: #24292f;
        --text-secondary: #57606a;
        --card-bg: #f6f8fa;
        --card-border: #d0d7de;
        --accent-green: #1a7f37;
        --accent-blue: #0969da;
        --accent-purple: #8250df;
        --accent-pink: #cf222e;
        --accent-orange: #9a6700;
        --accent-yellow: #9a6700;
    }

    [data-theme="cyberpunk"] {
        --bg-color: #050505;
        --text-primary: #fcee0a;
        --text-secondary: #00f0ff;
        --card-bg: #111111;
        --card-border: #00f0ff;
        --accent-green: #39ff14;
        --accent-blue: #00f0ff;
        --accent-purple: #ff00ff;
        --accent-pink: #ff0099;
        --accent-orange: #fcee0a;
        --accent-yellow: #fcee0a;
    }

    [data-theme="sunset"] {
        --bg-color: #2D1B2E;
        --text-primary: #FFCB9A;
        --text-secondary: #D1E8E2;
        --card-bg: rgba(185, 88, 165, 0.15);
        --card-border: #E86A92;
        --accent-green: #41EAD4;
        --accent-blue: #F7F052;
        --accent-purple: #F3C3D7;
        --accent-pink: #FF6663;
        --accent-orange: #F5B441;
        --accent-yellow: #F7D000;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: var(--bg-color);
        color: var(--text-primary);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
    }

    /* ========================================
   INPUT FORM SECTION
   ======================================== */

    .main-container {
        width: 100%;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: 100vh;
    }

    .input-section {
        width: 100%;
        max-width: 480px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: 100vh;
    }

    #input-section.card {
        background: rgba(22, 27, 34, 0.6);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(48, 54, 61, 0.5);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .header-content {
        text-align: center;
        margin-bottom: 32px;
    }

    h1 {
        font-size: 42px;
        font-weight: 800;
        margin-bottom: 12px;
        font-family: 'Space Grotesk', 'Inter', sans-serif;
        background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple), var(--accent-pink));
        background-size: 200% 200%;
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradientShift 8s ease infinite;
    }

    @keyframes gradientShift {

        0%,
        100% {
            background-position: 0% 50%;
        }

        50% {
            background-position: 100% 50%;
        }
    }

    .subtitle {
        color: var(--text-secondary);
        font-size: 18px;
        font-weight: 400;
    }

    .form-group,
    .input-group {
        margin-bottom: 20px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-secondary);
        font-size: 14px;
        font-weight: 500;
    }

    input,
    select {
        background: rgba(13, 17, 23, 0.6);
        border: 1px solid rgba(48, 54, 61, 0.8);
        color: var(--text-primary);
        width: 100%;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 15px;
        font-family: inherit;
        transition: all 0.3s ease;
    }

    input:focus,
    select:focus {
        outline: none;
        border-color: var(--accent-blue);
        background: rgba(13, 17, 23, 0.8);
        box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
    }

    input::placeholder {
        color: var(--text-secondary);
        opacity: 0.6;
    }

    .helper-text {
        font-size: 12px;
        color: var(--text-secondary);
        margin-top: 6px;
        opacity: 0.8;
    }

    .button-group {
        display: flex;
        gap: 12px;
        margin-top: 24px;
    }

    .primary-button,
    .secondary-button {
        padding: 14px 24px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .primary-button {
        background: var(--accent-green);
        color: white;
        flex: 1;
    }

    .primary-button:hover {
        background: #2c974b;
        transform: translateY(-1px);
    }

    .secondary-button {
        background: transparent;
        border: 1px solid var(--card-border);
        color: var(--text-primary);
        flex: 1;
    }

    .secondary-button:hover {
        border-color: var(--accent-blue);
        background: rgba(88, 166, 255, 0.1);
    }

    .error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #ff6b6b;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        margin-top: 16px;
    }

    .hidden {
        display: none !important;
    }

    .loader {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    /* ========================================
   RESULTS PAGE - MATCHING REFERENCE DESIGN
   ======================================== */

    .results-wrapper {
        width: 100%;
        max-width: 782px;
        margin: 0 auto;
        padding: 20px;
    }

    .actions-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding: 12px 0;
    }

    .action-btn {
        background: rgba(22, 27, 34, 0.6);
        border: 1px solid var(--card-border);
        color: var(--text-primary);
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .action-btn:hover {
        border-color: var(--accent-blue);
        background: rgba(88, 166, 255, 0.1);
    }

    .action-btn.primary {
        background: var(--accent-green);
        border-color: var(--accent-green);
        color: white;
    }

    .action-btn.primary:hover {
        background: #2c974b;
    }

    .right-actions {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .theme-selector {
        background: rgba(22, 27, 34, 0.6);
        border: 1px solid var(--card-border);
        color: var(--text-primary);
        padding: 10px 14px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
    }

    /* ========================================
   WRAPPED CONTENT - CLEAN MOBILE-FIRST DESIGN
   ======================================== */

    .wrapped-content {
        background: var(--bg-color);
        padding: 24px;
        border-radius: 20px;
        border: 1px solid var(--card-border);
    }

    /* Header with Avatar - Like Reference */
    .wrapped-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
        padding: 16px;
    }

    .profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 3px solid var(--accent-purple);
        box-shadow: 0 0 20px rgba(188, 140, 255, 0.3);
    }

    .header-info {
        flex: 1;
    }

    .username {
        font-size: 28px;
        font-weight: 700;
        margin: 0 0 4px 0;
        color: var(--text-primary);
        background: none;
        -webkit-text-fill-color: var(--text-primary);
    }

    .year-label {
        font-size: 14px;
        color: var(--accent-pink);
        margin: 0;
    }

    /* Contribution Graph Card */
    .graph-card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
    }

    .month-labels {
        display: flex;
        justify-content: space-between;
        padding: 0 4px;
        margin: 8px 0;
    }

    .month-labels span {
        font-size: 10px;
        color: var(--text-secondary);
        text-transform: uppercase;
        flex: 1;
        text-align: center;
    }

    .contribution-graph {
        display: flex;
        gap: 2px;
        justify-content: center;
        padding: 8px 0;
        overflow-x: auto;
    }

    .week-col {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .day-box {
        width: 10px;
        height: 10px;
        background: rgba(48, 54, 61, 0.6);
        border-radius: 2px;
        transition: all 0.2s ease;
    }

    .day-box:hover {
        transform: scale(1.4);
        z-index: 10;
    }

    .day-box.l0 {
        background: rgba(48, 54, 61, 0.4);
    }

    .day-box.l1 {
        background: rgba(46, 160, 67, 0.4);
    }

    .day-box.l2 {
        background: rgba(46, 160, 67, 0.6);
    }

    .day-box.l3 {
        background: rgba(46, 160, 67, 0.8);
    }

    .day-box.l4 {
        background: #2ea043;
    }

    .contribution-count {
        font-size: 12px;
        color: var(--text-secondary);
        text-align: left;
        margin-top: 12px;
    }

    /* ========================================
   STATS GRID - 2 COLUMN LAYOUT LIKE REFERENCE
   ======================================== */

    .stats-grid {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .stat-card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 20px;
        display: flex;
        flex-direction: column;
    }

    .stat-card:hover {
        border-color: rgba(88, 166, 255, 0.4);
    }

    /* Two column row for side by side cards */
    .stats-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    .stat-label {
        font-size: 12px;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 8px;
        font-weight: 500;
    }

    .stat-icon {
        font-size: 14px;
    }

    .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-primary);
        margin: 0;
        line-height: 1.2;
    }

    /* Persona Card - Full Width */
    .persona-card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
    }

    .persona-value {
        font-size: 28px;
        color: var(--text-primary);
        margin: 8px 0;
    }

    .persona-desc {
        font-size: 13px;
        color: var(--text-secondary);
        margin: 8px 0 0 0;
        line-height: 1.4;
    }

    /* Color variations */
    .stat-value.green {
        color: var(--accent-green);
    }

    .stat-value.blue {
        color: var(--accent-blue);
    }

    .stat-value.purple {
        color: var(--accent-purple);
    }

    .stat-value.pink {
        color: var(--accent-pink);
    }

    .stat-value.orange {
        color: var(--accent-orange);
    }

    .stat-value.yellow {
        color: var(--accent-yellow);
    }

    .repo-name {
        font-size: 18px !important;
        word-break: break-word;
    }

    /* Footer */
    .wrapped-footer {
        text-align: left;
        padding: 16px 0 0 0;
        color: var(--text-secondary);
        font-size: 12px;
    }

    .wrapped-footer p {
        margin: 0;
        opacity: 0.5;
    }

    /* ========================================
   RESPONSIVE
   ======================================== */

    @media (max-width: 640px) {
        .results-wrapper {
            padding: 12px;
        }

        .wrapped-content {
            padding: 16px;
        }

        .stats-row {
            grid-template-columns: 1fr 1fr;
        }

        .stat-value {
            font-size: 28px;
        }

        .actions-bar {
            flex-wrap: wrap;
            gap: 10px;
        }
    }

    /* ========================================
   ANIMATIONS
   ======================================== */

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .fade-in {
        animation: fadeIn 0.6s ease-out;
    }

    /* ========================================
   NEW COMPONENTS (BADGES & REPOS)
   ======================================== */

    .full-width {
        grid-column: 1 / -1;
    }

    /* Badges Grid */
    .badges-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
        margin-top: 12px;
    }

    .badge-item {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: transform 0.2s ease;
    }

    .badge-item:hover {
        transform: translateY(-2px);
        background: rgba(255, 255, 255, 0.08);
    }

    .badge-icon {
        font-size: 24px;
    }

    .badge-info {
        display: flex;
        flex-direction: column;
    }

    .badge-label {
        font-size: 13px;
        font-weight: 700;
        color: var(--text-primary);
    }

    .badge-desc {
        font-size: 11px;
        color: var(--text-secondary);
    }

    /* Top Repos Grid */
    .repo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
        margin-top: 12px;
    }

    .repo-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid var(--card-border);
        border-radius: 10px;
        padding: 14px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .repo-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
    }

    .repo-name-small {
        font-size: 14px;
        font-weight: 700;
        color: var(--text-primary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 70%;
    }

    .repo-stars {
        font-size: 12px;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .repo-desc {
        font-size: 12px;
        color: var(--text-secondary);
        margin-bottom: 12px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        min-height: 2.4em;
    }

    .repo-lang {
        font-size: 11px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .lang-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
    }

    /* Mobile Adjustments */
    @media (max-width: 600px) {
        .badges-grid {
            grid-template-columns: 1fr 1fr;
        }

        .repo-grid {
            grid-template-columns: 1fr;
        }
    }

    /* ========================================
   HOME PAGE FEATURES
   ======================================== */

    .features-preview {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 24px;
        width: 100%;
        animation-delay: 0.2s;
        /* Fade in slightly after the card */
    }

    @media (min-width: 600px) {
        .features-preview {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    .feature-item {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 12px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-align: center;
        color: var(--text-secondary);
        font-size: 13px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .feature-item:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
        color: var(--text-primary);
        border-color: var(--accent-blue);
    }

    .feature-icon {
        font-size: 20px;
    }

    /* ========================================
   FOOTER
   ======================================== */
    .main-footer {
        text-align: center;
        margin-top: 40px;
        padding-bottom: 20px;
        color: var(--text-secondary);
        font-size: 14px;
        width: 100%;
        animation-delay: 0.3s;
    }

    .main-footer a {
        color: var(--text-primary);
        text-decoration: none;
        font-weight: 600;
        transition: color 0.2s ease;
    }

    .main-footer a:hover {
        color: var(--accent-blue);
        text-decoration: underline;
    }
</style>

<body>
    <div class="main-container">
        <div class="input-section">
            <div id="input-section" class="card fade-in">
                <div class="header-content">
                    <h1>GitHub Wrapped</h1>
                    <p class="subtitle">Discover your coding story, unlock badges, and find your developer persona üöÄ
                    </p>
                </div>

                <form id="wrapped-form">
                    <div class="form-group">
                        <label for="username">GitHub Username</label>
                        <input type="text" id="username" placeholder="e.g. torvalds" required>
                    </div>

                    <div class="input-group">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <label for="token" style="margin-bottom: 0;">Personal Access Token</label>
                            <a href="https://github.com/settings/tokens?type=beta" target="_blank"
                                style="font-size: 12px; color: var(--accent-blue); text-decoration: none;">How to create
                                one? ‚Üí</a>
                        </div>
                        <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxx" required>
                        <p class="helper-text">Token is used only locally to fetch private contributions.</p>
                    </div>

                    <div class="input-group">
                        <label for="year">Year</label>
                        <select id="year">
                            <option value="2025" selected>2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="theme-select">Theme üé®</label>
                        <select id="theme-select">
                            <option value="default">GitHub Dark (Default)</option>
                            <option value="light">GitHub Light</option>
                            <option value="cyberpunk">Cyberpunk Neon</option>
                            <option value="sunset">Sunset Vibes</option>
                        </select>
                    </div>

                    <div class="button-group" style="flex-direction: row; gap: 10px;">
                        <button type="button" id="demo-btn" class="secondary-button"
                            style="margin-top: 0; width: 50%; justify-content: center; border: 1px solid var(--text-secondary); color: var(--text-primary);">
                            See Demo
                        </button>
                        <button type="submit" id="generate-btn" class="primary-button" style="width: 50%;">
                            <span class="btn-text">Generate</span>
                            <!-- <div class="loader hidden"></div> -->
                        </button>
                    </div>

                    <div id="error-message" class="error hidden"></div>
                </form>
            </div>

            <div class="features-preview fade-in">
                <div class="feature-item">
                    <span class="feature-icon">üìä</span>
                    <span>Contribution Graph</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üß©</span>
                    <span>Developer Persona</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üèÜ</span>
                    <span>Unlock Badges</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üåü</span>
                    <span>Top Projects</span>
                </div>
            </div>

            <footer class="main-footer fade-in">
                <p>Built with <span style="color: #ff4757;">&hearts;</span> by <a
                        href="https://programmerraja.github.io/" target="_blank">ProgrammerRaja</a></p>
            </footer>
        </div>

        <div id="results-section" class="hidden">
            <div id="wrapped-content">
                <!-- Content will be injected here via JS -->
            </div>
        </div>
    </div>


    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>

        /**
         * GitHub Wrapped - Client Side Logic
         */

        // Simple Vanilla Tilt Implementation (Embedded for reliability)
        class VanillaTilt {
            static init(elements, settings = {}) {
                if (!(elements instanceof NodeList)) elements = [elements];
                elements.forEach(element => {
                    if (!element) return;
                    element.addEventListener('mousemove', (e) => {
                        const rect = element.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        const centerX = rect.width / 2;
                        const centerY = rect.height / 2;
                        const rotateX = ((y - centerY) / centerY) * -10; // Max tilt 10deg
                        const rotateY = ((x - centerX) / centerX) * 10;

                        element.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
                    });

                    element.addEventListener('mouseleave', () => {
                        element.style.transform = `perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)`;
                    });

                    element.style.transition = 'transform 0.1s ease';
                });
            }
        }

        class GitHubWrappedApp {
            constructor() {
                this.inputSection = document.querySelector('.input-section');
                this.resultsSection = document.getElementById('results-section');
                this.form = document.getElementById('wrapped-form');
                this.loader = document.querySelector('.loader');
                this.btnText = document.querySelector('.btn-text');
                this.errorMsg = document.getElementById('error-message');
                this.content = document.getElementById('wrapped-content');

                this.initEvents();
            }

            initEvents() {
                this.form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const username = document.getElementById('username').value.trim();
                    const token = document.getElementById('token').value.trim();
                    const year = document.getElementById('year').value;

                    if (!username || !token) return;

                    await this.generateWrapped(username, token, year);
                });

                // Demo button
                const demoBtn = document.getElementById('demo-btn');
                if (demoBtn) {
                    demoBtn.addEventListener('click', () => {
                        this.runDemo();
                    });
                }
            }

            runDemo() {
                const demoStats = {
                    username: 'demo-user',
                    name: 'Demo Architect',
                    avatarUrl: 'https://avatars.githubusercontent.com/u/583231?v=4',
                    year: 2025,
                    totalCommits: 4521,
                    totalContributions: 5120,
                    totalPRs: 342,
                    longestStreak: 42,
                    mostActiveDay: 'Wednesday',
                    rankPercent: 'Top 1%',
                    linesAdded: 154200,
                    linesDeleted: 89000,
                    mostActiveDay: 'Wednesday',
                    mostActiveMonth: 'October',
                    totalStars: 1250,
                    createdReposCount: 24,
                    archetype: 'The Machine &#129302;',
                    archetypeDesc: 'Unstoppable! Your consistency is scary.',
                    mostCommittedRepo: 'torvalds/linux',
                    topLanguage: 'C++',
                    powerLevel: 'Legend',
                    calendar: { weeks: [], contributionDays: [] } // Mock if needed
                };

                // Mock Calendar Data for graph
                const mockWeeks = [];
                for (let i = 0; i < 53; i++) {
                    const days = [];
                    for (let d = 0; d < 7; d++) {
                        days.push({
                            contributionCount: Math.random() > 0.3 ? Math.floor(Math.random() * 15) : 0,
                            date: '2025-01-01' // Dummy date
                        });
                    }
                    mockWeeks.push({ contributionDays: days });
                }
                demoStats.calendar.weeks = mockWeeks;

                this.currentStats = demoStats;
                this.render(demoStats);
                this.toggleView(false);
            }

            shareOnTwitter() {
                if (!this.currentStats) return;
                const text = `I generated ${this.currentStats.linesAdded.toLocaleString()} lines of code in ${this.currentStats.year}! \uD83D\uDE80\n\nMy Power Level is '${this.currentStats.powerLevel}'.\n\nGet your #GitHubWrapped at http://programmerraja.github.io/githubwrap/`;
                const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
                window.open(url, '_blank');
            }

            toggleLoading(isLoading) {
                if (isLoading) {
                    // this.loader.classList.remove('hidden');
                    this.btnText.textContent = 'Crunching Numbers...';
                    this.errorMsg.classList.add('hidden');
                } else {
                    // this.loader.classList.add('hidden');
                    this.btnText.textContent = 'Generate Wrapped';
                }
            }

            toggleView(showInput) {
                if (showInput) {
                    this.inputSection.classList.remove('hidden');
                    this.resultsSection.classList.add('hidden');
                    document.body.style.alignItems = 'flex-start';
                } else {
                    this.inputSection.classList.add('hidden');
                    this.resultsSection.classList.remove('hidden');
                    document.body.style.alignItems = 'flex-start';
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }

            showError(msg) {
                this.errorMsg.textContent = msg;
                this.errorMsg.classList.remove('hidden');
            }

            async generateWrapped(username, token, year) {
                this.toggleLoading(true);

                try {
                    const data = await this.fetchUserStats(username, token, year);
                    const stats = this.processStats(data, username, year);
                    this.render(stats);
                    this.toggleView(false);
                } catch (error) {
                    console.error(error);
                    this.showError(error.message);
                } finally {
                    this.toggleLoading(false);
                }
            }

            async fetchUserStats(username, token, year) {
                const fromDate = `${year}-01-01T00:00:00Z`;
                const toDate = `${year}-12-31T23:59:59Z`;

                const query = `
          query($userName:String!, $from:DateTime!, $to:DateTime!) {
            user(login: $userName) {
              name
              login
              avatarUrl
              contributionsCollection(from: $from, to: $to) {
                totalCommitContributions
                totalIssueContributions
                totalPullRequestContributions
                totalRepositoryContributions
                contributionCalendar {
                  totalContributions
                  weeks {
                    contributionDays {
                      contributionCount
                      date
                      weekday
                    }
                  }
                }
                pullRequestContributions(first: 100) {
                  nodes {
                    pullRequest {
                      additions
                      deletions
                    }
                  }
                }
                commitContributionsByRepository(maxRepositories: 100) {
                  repository {
                    nameWithOwner
                    isPrivate
                    primaryLanguage {
                      name
                      color
                    }
                  }
                  contributions {
                    totalCount
                  }
                }
              }
              # Fetch recent repos for "Created Repos" count
              recentRepos: repositories(first: 100, ownerAffiliations: OWNER, orderBy: {field: CREATED_AT, direction: DESC}) {
                nodes {
                  name
                  createdAt
                  isFork
                }
              }
               # Fetch top starred repos for "Total Stars" count AND list
              topStarredRepos: repositories(first: 5, ownerAffiliations: OWNER, orderBy: {field: STARGAZERS, direction: DESC}) {
                nodes {
                  name
                  stargazerCount
                  description
                  url
                  primaryLanguage {
                    name
                    color
                  }
                }
              }
            }
          }
        `;

                const response = await fetch('https://api.github.com/graphql', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query,
                        variables: {
                            userName: username,
                            from: fromDate,
                            to: toDate
                        }
                    })
                });

                if (!response.ok) {
                    if (response.status === 401) throw new Error('Invalid Token. Please check your permissions.');
                    if (response.status === 404) throw new Error('User not found.');
                    throw new Error(`GitHub API Error: ${response.statusText}`);
                }

                const result = await response.json();

                if (result.errors) {
                    throw new Error(result.errors[0].message);
                }

                if (!result.data || !result.data.user) {
                    throw new Error('User not found.');
                }

                return result.data;
            }

            processStats(data, username, year) {
                const user = data.user;
                const collection = user.contributionsCollection;

                // Daily Averages and Active Day logic...
                const daysWithContributions = collection.contributionCalendar.weeks
                    .flatMap(week => week.contributionDays)
                    .filter(day => day.contributionCount > 0);

                const totalDaysCoded = daysWithContributions.length;
                const totalCommits = collection.totalCommitContributions;

                // Active Day & Month
                const dayActivity = {};
                const monthActivity = {};
                const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

                collection.contributionCalendar.weeks.forEach(week => {
                    week.contributionDays.forEach(day => {
                        const date = new Date(day.date);
                        const dayName = dayNames[date.getDay()]; // Use getDay() for weekday index
                        const monthName = monthNames[date.getMonth()];

                        if (day.contributionCount > 0) {
                            dayActivity[dayName] = (dayActivity[dayName] || 0) + day.contributionCount;
                            monthActivity[monthName] = (monthActivity[monthName] || 0) + day.contributionCount;
                        }
                    });
                });

                const mostActiveDay = Object.entries(dayActivity).sort((a, b) => b[1] - a[1])[0]?.[0] || 'N/A';
                const mostActiveMonth = Object.entries(monthActivity).sort((a, b) => b[1] - a[1])[0]?.[0] || 'N/A';

                // Process Top Starred Repos
                let topReposList = [];
                let totalStars = 0;

                if (user.topStarredRepos && user.topStarredRepos.nodes) {
                    topReposList = user.topStarredRepos.nodes.map(repo => ({
                        name: repo.name,
                        stars: repo.stargazerCount,
                        desc: repo.description,
                        lang: repo.primaryLanguage ? repo.primaryLanguage.name : null,
                        langColor: repo.primaryLanguage ? repo.primaryLanguage.color : '#ccc'
                    })).filter(r => r.stars > 0);

                    totalStars = topReposList.reduce((acc, repo) => acc + repo.stars, 0);
                }

                // Calculate Created Repos (Created in this year and NOT a fork)
                const createdReposCount = user.recentRepos.nodes.filter(repo => {
                    const createdYear = new Date(repo.createdAt).getFullYear();
                    return createdYear === parseInt(year) && !repo.isFork;
                }).length;

                // Streak Logic
                let currentStreak = 0;
                let longestStreak = 0;
                const allDays = collection.contributionCalendar.weeks
                    .flatMap(w => w.contributionDays)
                    .sort((a, b) => new Date(a.date) - new Date(b.date));

                for (const day of allDays) {
                    if (day.contributionCount > 0) {
                        currentStreak++;
                        if (currentStreak > longestStreak) longestStreak = currentStreak;
                    } else {
                        currentStreak = 0;
                    }
                }

                // Calculate Lines Added/Deleted (from available PRs)
                let linesAdded = 0;
                let linesDeleted = 0;
                if (collection.pullRequestContributions && collection.pullRequestContributions.nodes) {
                    collection.pullRequestContributions.nodes.forEach(node => {
                        if (node.pullRequest) {
                            linesAdded += node.pullRequest.additions;
                            linesDeleted += node.pullRequest.deletions;
                        }
                    });
                }

                // Top Repo
                const repos = collection.commitContributionsByRepository.sort((a, b) =>
                    b.contributions.totalCount - a.contributions.totalCount
                );
                const mostCommittedRepo = repos[0] ? repos[0].repository.nameWithOwner : 'N/A';

                // Top Language
                const languageMap = {};
                repos.forEach(item => {
                    if (item.repository.primaryLanguage) {
                        const lang = item.repository.primaryLanguage.name;
                        languageMap[lang] = (languageMap[lang] || 0) + item.contributions.totalCount;
                    }
                });
                const topLanguage = Object.entries(languageMap).sort((a, b) => b[1] - a[1])[0]?.[0] || 'N/A';

                // Power Level
                let powerLevel = 'Novice';
                if (totalCommits > 100) { powerLevel = 'Explorer'; }
                if (totalCommits > 500) { powerLevel = 'Adventurer'; }
                if (totalCommits > 1000) { powerLevel = 'Master'; }
                if (totalCommits > 2500) { powerLevel = 'Legend'; }
                if (totalCommits > 5000) { powerLevel = 'God Mode'; }

                // Personality Archetype Logic
                let archetype = 'The Builder &#127959;';
                let archetypeDesc = 'You consistently build and ship code.';

                const totalContributions = collection.contributionCalendar.totalContributions;
                const weekendCount = (dayActivity['Saturday'] || 0) + (dayActivity['Sunday'] || 0);
                const weekendRatio = totalContributions > 0 ? weekendCount / totalContributions : 0;
                const langCount = Object.keys(languageMap).length;
                const topLangVal = Object.values(languageMap).sort((a, b) => b - a)[0] || 0;
                const topLangRatio = totalContributions > 0 ? topLangVal / totalContributions : 0;

                if (longestStreak > 60) {
                    archetype = 'The Unstoppable &#128640;';
                    archetypeDesc = `A ${longestStreak}-day streak? Do you even sleep?`;
                } else if (weekendRatio > 0.3) {
                    archetype = 'Weekend Warrior &#9876;';
                    archetypeDesc = 'You live for the weekend... output.';
                } else if (langCount > 8) {
                    archetype = 'The Polyglot &#129436;';
                    archetypeDesc = 'You speak more languages than C-3PO.';
                } else if (topLangRatio > 0.8 && totalCommits > 1000) {
                    archetype = `${topLanguage} Purist &#128142;`;
                    archetypeDesc = `You breathe ${topLanguage}. Other languages don't exist.`;
                } else if (totalCommits > 4000) {
                    archetype = 'The 10x Engineer &#129412;';
                    archetypeDesc = 'Recruiters are probably sliding into your DMs right now.';
                } else if (collection.totalPullRequestContributions > totalCommits * 0.5) {
                    archetype = 'The Collaborator &#129309;';
                    archetypeDesc = 'Code review is your love language.';
                } else if (linesDeleted > linesAdded * 1.5) {
                    archetype = 'The Refactorer &#129529;';
                    archetypeDesc = 'Coding by subtraction. Beautiful.';
                }

                // Badges Logic
                const badges = [];
                if (longestStreak >= 30) badges.push({ icon: '&#128293;', label: 'On Fire', desc: '30+ day streak' });
                if (totalStars >= 100) badges.push({ icon: '&#11088;', label: 'Starstruck', desc: '100+ stars earned' });
                if (langCount >= 5) badges.push({ icon: '&#129504;', label: 'Big Brain', desc: '5+ languages' });
                if (collection.totalPullRequestContributions >= 100) badges.push({ icon: '&#128256;', label: 'Pull Shark', desc: '100+ PRs' });
                if (weekendRatio > 0.4) badges.push({ icon: '&#129499;', label: 'Night Walker', desc: 'Major weekend activity' });
                if (totalCommits >= 1000) badges.push({ icon: '&#127942;', label: 'Club 1k', desc: '1,000+ commits' });
                if (badges.length === 0) badges.push({ icon: '&#129370;', label: 'Humble Beginnings', desc: 'Just getting started' });

                return {
                    username: user.login,
                    name: user.name,
                    avatarUrl: user.avatarUrl,
                    year,
                    totalCommits,
                    totalContributions: collection.contributionCalendar.totalContributions,
                    totalPRs: collection.totalPullRequestContributions,
                    longestStreak,
                    mostActiveDay,
                    mostActiveMonth,
                    topLanguage,
                    mostCommittedRepo,
                    linesAdded,
                    linesDeleted,
                    powerLevel,
                    rankPercent: 'Top 50%',
                    totalStars,
                    createdReposCount,
                    archetype,
                    archetypeDesc,
                    topReposList,
                    badges,
                    calendar: collection.contributionCalendar
                };
            }

            render(stats) {
                this.currentStats = stats; // Store for sharing

                // Render Calendar Graph
                let graphHTML = '';
                const cropWeeks = stats.calendar.weeks.slice(0, 53); // Limit to ~1 year

                graphHTML = cropWeeks.map(week => {
                    const daysHTML = week.contributionDays.map(day => {
                        let level = 'l0';
                        if (day.contributionCount > 0) level = 'l1';
                        if (day.contributionCount > 5) level = 'l2';
                        if (day.contributionCount > 10) level = 'l3';
                        if (day.contributionCount > 20) level = 'l4';
                        return `<div class="day-box ${level}" data-count="${day.contributionCount}" data-date="${day.date}"></div>`;
                    }).join('');
                    return `<div class="week-col">${daysHTML}</div>`;
                }).join('');

                // Month Labels Generation
                const monthLabels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                let monthsHTML = `<div class="month-labels">`;
                monthLabels.forEach(m => monthsHTML += `<span>${m}</span>`);
                monthsHTML += `</div>`;

                // Render Badges
                let badgesHTML = '';
                if (stats.badges) {
                    badgesHTML = stats.badges.map(badge => `
                <div class="badge-item">
                    <div class="badge-icon">${badge.icon}</div>
                    <div class="badge-info">
                        <div class="badge-label">${badge.label}</div>
                        <div class="badge-desc">${badge.desc}</div>
                    </div>
                </div>
            `).join('');
                }

                // Render Top Repos
                let topReposHTML = '';
                if (stats.topReposList && stats.topReposList.length > 0) {
                    const reposs = stats.topReposList.slice(0, 3).map(repo => `
                <div class="repo-card">
                    <div class="repo-header">
                        <span class="repo-name-small">${repo.name}</span>
                        <div class="repo-stars">
                            <span>&#11088;</span> ${repo.stars}
                        </div>
                    </div>
                    <div class="repo-desc">${repo.desc || 'No description provided.'}</div>
                    <div class="repo-lang" style="color: ${repo.langColor}">
                        <span class="lang-dot" style="background-color: ${repo.langColor}"></span> ${repo.lang || 'Text'}
                    </div>
                </div>
            `).join('');

                    topReposHTML = `
                <div class="stat-card full-width">
                     <div class="stat-label"><span class="stat-icon">&#127775;</span> Top Pop Projects</div>
                     <div class="repo-grid">
                        ${reposs}
                     </div>
                </div>
            `;
                }

                this.content.innerHTML = `
            <div class="results-wrapper">
                <!-- Action Bar -->
                <div class="actions-bar">
                    <button id="back-btn" class="action-btn">‚Üê Back</button>
                    <div class="right-actions">
                        <select id="result-theme-select" class="theme-selector">
                            <option value="default">Dark</option>
                            <option value="light">Light</option>
                            <option value="cyberpunk">Cyber</option>
                            <option value="sunset">Sunset</option>
                        </select>
                        <button id="download-btn" class="action-btn primary">Download</button>
                    </div>
                </div>

                <!-- Capture Area -->
                <div id="capture-area" class="wrapped-content">
                    <!-- Header Section -->
                    <div class="wrapped-header">
                        <img src="${stats.avatarUrl}" class="profile-avatar" alt="${stats.username}">
                        <div class="header-info">
                            <h1 class="username">@${stats.username}</h1>
                            <p class="year-label">${stats.year} Year in Code</p>
                        </div>
                    </div>

                    <!-- Contribution Graph -->
                    <div class="graph-card">
                        ${monthsHTML}
                        <div class="contribution-graph">
                            ${graphHTML}
                        </div>
                        ${monthsHTML}
                        <p class="contribution-count">${stats.totalContributions.toLocaleString()} total contributions in ${stats.year}</p>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <!-- Developer Persona - Full Width -->
                        <div class="stat-card persona-card">
                            <div class="stat-label"><span class="stat-icon">&#129513;</span> Your Developer Persona</div>
                            <h2 class="stat-value persona-value">${stats.archetype}</h2>
                            <p class="persona-desc">${stats.archetypeDesc}</p>
                        </div>

                         <!-- Badges Section -->
                        <div class="stat-card full-width">
                             <div class="stat-label"><span class="stat-icon">&#127894;</span> Achievements Discovered</div>
                             <div class="badges-grid">
                                ${badgesHTML}
                             </div>
                        </div>

                        <!-- Row 1: Streak & Commits -->
                        <div class="stats-row">
                            <div class="stat-card">
                                <div class="stat-label"><span class="stat-icon">&#9889;</span> Longest Streak</div>
                                <h2 class="stat-value green" data-value="${stats.longestStreak}" data-suffix=" days">0 days</h2>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label"><span class="stat-icon">&#127942;</span> Total Commits</div>
                                <h2 class="stat-value yellow" data-value="${stats.totalCommits}">0</h2>
                            </div>
                        </div>

                         <!-- Row 2: Top Repo & Language -->
                        <div class="stats-row">
                            <div class="stat-card">
                                <div class="stat-label"><span class="stat-icon">&#127959;</span> Top Repo</div>
                                <h2 class="stat-value blue repo-name">${stats.mostCommittedRepo.split('/')[1] || stats.mostCommittedRepo}</h2>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label"><span class="stat-icon">&#128640;</span> Top Language</div>
                                <h2 class="stat-value blue">${stats.topLanguage}</h2>
                            </div>
                        </div>
                        
                      

                        <!-- Row 3: Month & Day -->
                        <div class="stats-row">
                            <div class="stat-card">
                                <div class="stat-label"><span class="stat-icon">&#128197;</span> Most Active Month</div>
                                <h2 class="stat-value purple">${stats.mostActiveMonth}</h2>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label"><span class="stat-icon">&#128202;</span> Most Active Day</div>
                                <h2 class="stat-value orange">${stats.mostActiveDay}</h2>
                            </div>
                        </div>

                        <!-- Row 4: Lines Added & Removed -->
                        <div class="stats-row">
                            <div class="stat-card">
                                <div class="stat-label"><span class="stat-icon">&#128200;</span> Lines Added</div>
                                <h2 class="stat-value green" data-value="${stats.linesAdded}" data-prefix="+">+0</h2>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label"><span class="stat-icon">&#128201;</span> Lines Removed</div>
                                <h2 class="stat-value pink" data-value="${stats.linesDeleted}" data-prefix="-">-0</h2>
                            </div>
                        </div>

                        <!-- Row 5: Stars & Repos -->
                        <div class="stats-row">
                            <div class="stat-card">
                                <div class="stat-label"><span class="stat-icon">&#11088;</span> Stars Earned</div>
                                <h2 class="stat-value yellow" data-value="${stats.totalStars}">0</h2>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label"><span class="stat-icon">&#128230;</span> Created Repos</div>
                                <h2 class="stat-value orange" data-value="${stats.createdReposCount}">0</h2>
                            </div>
                        </div>

                        <!-- Power Level - Full Width -->
                        <div class="stat-card">
                            <div class="stat-label"><span class="stat-icon">&#128737;</span> Power Level</div>
                            <h2 class="stat-value purple">${stats.powerLevel}</h2>
                        </div>

                          <!-- Top Starred Repos (New) -->
                        ${topReposHTML}
                    </div>

                    <!-- Footer -->
                    <div class="wrapped-footer">
                        <p>http://programmerraja.github.io/githubwrap/</p>
                    </div>
                </div>
            </div>
        `;

                // Trigger Animations
                this.animateNumbers();

                // Re-attach event listeners since we wiped innerHTML
                document.getElementById('back-btn').addEventListener('click', () => this.toggleView(true));
                document.getElementById('download-btn').addEventListener('click', () => this.downloadImage());

                // Result Theme Selector Logic
                const resultThemeSelect = document.getElementById('result-theme-select');
                const currentTheme = localStorage.getItem('git-wrapped-theme') || 'default';
                if (resultThemeSelect) {
                    resultThemeSelect.value = currentTheme;
                    resultThemeSelect.addEventListener('change', (e) => {
                        this.setTheme(e.target.value);
                        // Sync main form selector if exists
                        const mainSelector = document.getElementById('theme-select');
                        if (mainSelector) mainSelector.value = e.target.value;
                    });
                }

                // Add Tooltips to Contribution Graph
                this.addGraphTooltips();

                // Pre-load avatar as base64 for download functionality
                this.preloadAvatarAsBase64();
            }

            async preloadAvatarAsBase64() {
                const avatarImg = document.querySelector('.profile-avatar');
                if (!avatarImg || !avatarImg.src.startsWith('http')) return;

                try {
                    // Create a hidden image to load with CORS
                    const img = new Image();
                    img.crossOrigin = 'anonymous';

                    await new Promise((resolve, reject) => {
                        img.onload = resolve;
                        img.onerror = reject;
                        img.src = avatarImg.src;
                    });

                    // Draw to canvas and convert to base64
                    const canvas = document.createElement('canvas');
                    canvas.width = img.naturalWidth;
                    canvas.height = img.naturalHeight;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);

                    // Store base64 for download
                    this.avatarBase64 = canvas.toDataURL('image/png');
                } catch (e) {
                    console.warn('Could not preload avatar:', e);
                    this.avatarBase64 = null;
                }
            }

            addRippleEffect() {
                document.querySelectorAll('.bento-card').forEach(card => {
                    card.addEventListener('click', function (e) {
                        const ripple = document.createElement('span');
                        const rect = this.getBoundingClientRect();
                        const size = Math.max(rect.width, rect.height);
                        const x = e.clientX - rect.left - size / 2;
                        const y = e.clientY - rect.top - size / 2;

                        ripple.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                    background: radial-gradient(circle, rgba(88, 166, 255, 0.3) 0%, transparent 70%);
                    border-radius: 50%;
                    transform: scale(0);
                    animation: ripple 0.6s ease-out;
                    pointer-events: none;
                    z-index: 1;
                `;

                        this.appendChild(ripple);

                        setTimeout(() => ripple.remove(), 600);
                    });
                });

                // Add ripple animation to CSS dynamically
                if (!document.getElementById('ripple-style')) {
                    const style = document.createElement('style');
                    style.id = 'ripple-style';
                    style.textContent = `
                @keyframes ripple {
                    to {
                        transform: scale(2);
                        opacity: 0;
                    }
                }
            `;
                    document.head.appendChild(style);
                }
            }

            addGraphTooltips() {
                const dayBoxes = document.querySelectorAll('.day-box');

                // Create tooltip element
                const tooltip = document.createElement('div');
                tooltip.className = 'graph-tooltip';
                tooltip.style.cssText = `
            position: fixed;
            background: rgba(22, 27, 34, 0.98);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(88, 166, 255, 0.4);
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 13px;
            color: var(--text-primary);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 1000;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            font-weight: 500;
        `;
                document.body.appendChild(tooltip);

                dayBoxes.forEach((box) => {
                    box.addEventListener('mouseenter', (e) => {
                        const count = box.getAttribute('data-count') || '0';
                        const date = box.getAttribute('data-date') || '';

                        // Format date nicely
                        let dateStr = '';
                        if (date) {
                            const d = new Date(date);
                            dateStr = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                        }

                        const contributionText = count === '1' ? 'contribution' : 'contributions';
                        tooltip.innerHTML = `
                    <div style="font-weight: 600; color: var(--accent-green);">${count} ${contributionText}</div>
                    ${dateStr ? `<div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">${dateStr}</div>` : ''}
                `;
                        tooltip.style.opacity = '1';
                    });

                    box.addEventListener('mousemove', (e) => {
                        tooltip.style.left = (e.clientX + 12) + 'px';
                        tooltip.style.top = (e.clientY + 12) + 'px';
                    });

                    box.addEventListener('mouseleave', () => {
                        tooltip.style.opacity = '0';
                    });
                });
            }

            initScrollReveal() {
                const observerOptions = {
                    threshold: 0.1,
                    rootMargin: '0px 0px -50px 0px'
                };

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.style.opacity = '1';
                            entry.target.style.transform = 'translateY(0)';
                        }
                    });
                }, observerOptions);

                // Observe all bento cards
                document.querySelectorAll('.bento-card').forEach(card => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                    observer.observe(card);
                });
            }

            animateNumbers() {
                const elements = document.querySelectorAll('[data-value]');
                elements.forEach(el => {
                    const target = parseInt(el.getAttribute('data-value'));
                    const suffix = el.getAttribute('data-suffix') || '';
                    const prefix = el.getAttribute('data-prefix') || '';

                    if (isNaN(target)) return;

                    let start = 0;
                    const duration = 1500; // ms
                    const steps = 60;
                    const increment = target / steps;

                    const timer = setInterval(() => {
                        start += increment;
                        if (start >= target) {
                            el.textContent = prefix + target.toLocaleString() + suffix;
                            clearInterval(timer);
                        } else {
                            el.textContent = prefix + Math.floor(start).toLocaleString() + suffix;
                        }
                    }, duration / steps);
                });
            }

            async downloadImage() {
                const element = document.getElementById('capture-area');
                const btn = document.getElementById('download-btn');
                const originalText = btn.textContent;
                btn.textContent = 'Capturing...';

                const avatarImg = element.querySelector('.profile-avatar');
                const originalSrc = avatarImg ? avatarImg.src : null;

                try {
                    // Use pre-loaded base64 avatar if available
                    if (avatarImg && this.avatarBase64) {
                        avatarImg.src = this.avatarBase64;
                    }

                    const canvas = await html2canvas(element, {
                        backgroundColor: '#0d1117',
                        scale: 2,
                        useCORS: true,
                        allowTaint: true,
                        logging: false
                    });

                    const link = document.createElement('a');
                    link.download = `git-wrapped-${this.currentStats?.year || new Date().getFullYear()}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                } catch (err) {
                    console.error(err);
                    alert('Failed to generate image');
                } finally {
                    // Restore original avatar src
                    if (avatarImg && originalSrc) {
                        avatarImg.src = originalSrc;
                    }
                    btn.textContent = originalText;
                }
            }

            async convertImageToBase64(imageUrl) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.naturalWidth;
                        canvas.height = img.naturalHeight;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        try {
                            resolve(canvas.toDataURL('image/png'));
                        } catch (e) {
                            reject(e);
                        }
                    };
                    img.onerror = reject;
                    // Add cache buster to force fresh request with CORS headers
                    img.src = imageUrl + (imageUrl.includes('?') ? '&' : '?') + 'cors=' + Date.now();
                });
            }

            escapeHTML(str) {
                return str.replace(/[&<>'"]/g,
                    tag => ({
                        '&': '&amp;',
                        '<': '&lt;',
                        '>': '&gt;',
                        "'": '&#39;',
                        '"': '&quot;'
                    }[tag]));
            }
            // Theme Management
            initTheme() {
                const savedTheme = localStorage.getItem('git-wrapped-theme') || 'default';
                this.setTheme(savedTheme);

                const themeSelect = document.getElementById('theme-select');
                if (themeSelect) {
                    themeSelect.value = savedTheme;
                    themeSelect.addEventListener('change', (e) => {
                        this.setTheme(e.target.value);
                    });
                }
            }

            setTheme(themeName) {
                document.body.setAttribute('data-theme', themeName);
                localStorage.setItem('git-wrapped-theme', themeName);
            }
        }

        // Initialize
        const app = new GitHubWrappedApp();
        app.initTheme();


    </script>
</body>

</html>